<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1.0'>
    <title>newsbot</title>
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
  </head>
  <body>
    <div id='app'>
      <div id='wholebox'>
        <div id='chatbox'>
          <div id='scrollbox'>
          </div>
          <div id='inputline'>
            <form id='form' action='/accept' method="post" name="form">
              {% csrf_token %}
              <input id='inputbox' type="text" name="q"></input>
              <input id='hiddenbox' type='hidden' name='hidden'></form>
              <input id='inputbutton' type='submit' value='âœ“'></input>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- built files will be auto injected -->
  </body>
</html>

<script>
  var count = 0
  function getStyle(element, attr){
    if(element.currentStyle){
      return element.currentStyle[attr];
    }else{
      return window.getComputedStyle(element, false)[attr];
    }
  }
  var inputbox = document.getElementById('inputbox')
  var hiddenbox = document.getElementById('hiddenbox')
  var scrollbox = document.getElementById('scrollbox')
  form.onsubmit = function(e){
    e.preventDefault()
    //states start with time_step 0, here send the time step of the state after user send a message'
    var form = $(this)
    hiddenbox.value = count    
    $.ajax({
      type: form.attr('method'),
      url: form.attr('action'),
      data: form.serialize(),
      success: function(data){
        console.log(data)
      }
    })
    count = count + 1    
    creatediv('user')
    creatediv('bot')
  }
  function creatediv(messagetype = 'user'){
    var div = document.createElement('div')
    if (messagetype === 'user'){
      div.innerHTML = inputbox.value
      inputbox.value = ''
      div.className = 'usermessage'
    }
    else if (messagetype === 'bot'){
      div.innerHTML = '{{ bot_message }}'
      div.className = 'botmessage'
    }
    scrollbox.appendChild(div)
  }
</script>

<style>
  #wholebox{
    width: 250px;
    height: 450px;
    margin:0 auto;
    background-color: rgb(224,224,240);
    border-radius: 20px;
    position: relative;
  }
  #chatbox{
    width: 90%;
    height: 90%;
    margin:0 auto;
    background-color: rgb(240,240,250);
    position: absolute;
    top: 5%;
    left: 5%;
    overflow: hidden;
  }
  #scrollbox{
    height: 90%;
  }
  #inputline{
    height: 10%;
    background-color: rgb(245,245,255);
    position: relative;
    bottom: 0%;
  }
  #inputbox{
    height: 50%;
    width: 75%;
    position: absolute;
    top: 20%;
    left: 5%;
    background-color: rgb(255,255,255);
    border-radius: 20px;
    border: none;
  }
  #inputbutton{
    height: 20px;
    width: 20px;
    border-radius: 10px;
    position: absolute;
    top: 50%;
    right: 5%;
    margin-top: -10px;
    background-color: rgb(200,200,240);
    border: none;
  }
  .usermessage{
    width: auto;
    height: auto;
    border-radius: 10px;
    float: right;
    clear: both;
    background-color: rgb(245,255,245);
    margin: 5px;
    padding: 0px 10px;
  }
  .botmessage{
    width: auto;
    height: auto;
    border-radius: 10px;
    float: left;
    clear: both;
    background-color: rgb(255,245,245);
    margin: 5px;
    padding: 0px 10px;
  }
</style>